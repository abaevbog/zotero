#citation-dialog {
	min-width: 800px;
	height: 100%;
	-moz-window-dragging: drag;

	body {
		height: inherit;
		margin: 0;
		color: var(--fill-primary);
		background: var(--material-background);
	}

	[hidden] {
		display: none !important;
	}
	
	.layout {
		display: contents;
	}
	
	.btn-icon {
		@include focus-ring;
		border: none;
		width: 28px;
		height: 28px;
		max-height: 28px;
		padding: 0;
		color: var(--fill-secondary);
		background-size: 60% !important;
		background-repeat: no-repeat;
		border-radius: 5px;
		-moz-window-dragging: no-drag;
		&:hover:not([disabled]) {
			cursor: pointer;
			background-color: var(--fill-quinary) !important;
		}
		&:active:not([disabled]) {
			background-color: var(--fill-quarternary) !important;
		}
	}

	#accept-button {
		@include svgicon("arrow-right", "universal", "20");
	}
	#cancel-button {
		@include svgicon("x", "universal", "20");
	}

	#search-row {
		margin: 5px 10px 5px 0;

		#z-icon-container {
			width: 36px; // same as left margin on .library-other-items

			#z-icon {
				background-image: url(chrome://zotero/skin/z.svg);
				width: 16px;
				height: 16px;
				pointer-events: all;
				align-self: baseline;
  				margin-top: 7px;
				margin-left: 12px;
			}
		}

		#loading-spinner {
			width: 28px;
			height: 28px;
			background-size: 60%;
			background-repeat: no-repeat;
			display: none;
			&[status="animate"] {
				display: inline-block;
			}
		}
	}

	.divider {
		border-bottom: 1px solid var(--color-panedivider);
		margin: 0;
	}
	.secondary-divider {
		border-bottom: 1px solid var(--fill-quinary);
		margin-left: 36px;
		margin-right: 10px;
	}

	.add-all {
		@include focus-ring;
		border-radius: 5px;
		font-weight: 400;
		text-decoration: underline;
		&:hover {
			cursor: pointer;
		}
	}

	#library-layout {
		#library-other-items {

			margin-left: 16px;
			// border-top: 1px solid var(--fill-quinary);
			padding-top: 8px;
			margin-inline-end: 4px;
			overflow-x: scroll;
			flex-shrink: 0; // make sure suggested items do not get shrunk when window is resized

			--item-width: 210px;
			--item-padding-horizontal: 4px;
			--item-margin: 4px;
			--item-horizontal-size: calc(var(--item-width) + 2*var(--item-padding-horizontal) + 2px);

			// faded edges of the scrollable area
			mask-image: linear-gradient(to right, transparent 0px, black 20px, black calc(100% - 20px), transparent 100%);
			// padding to offset the faded edge above, so it's not visible upon initial load
			padding-left: 20px;

			.section {
				margin-inline-end: 16px;
				// hide vertical divider
				.divider {
					display: none;
				}
				.header {
					color: var(--fill-secondary);
				}
		
				.itemsContainer {
					flex-direction: row;
					display: flex;
					margin-bottom: 10px;
					margin-top: 4px;
					gap: var(--item-margin);
					transition: gap 0.2s ease-in-out;
					border-radius: 5px;
		
					.item {
						height: 42px;
						flex-shrink: 0;
						width: var(--item-width);
						overflow: hidden;
						white-space: nowrap;
						border: 1px solid var(--fill-quarternary);
						border-radius: 5px;
						-moz-window-dragging: no-drag;
		
						display: flex;
						flex-direction: column;
						justify-content: center;
		
						cursor: default;
						padding: 0 var(--item-padding-horizontal);
						line-height: 18px;
						-moz-user-select: none;

						transform: translateX(0);
						transition: transform 0.2s ease-in-out;//, margin-inline 0.3s ease-in-out;
						
						// color has to be without opacity to the selected items deck
						background-color: var(--color-background);
		
						.title {
							overflow: hidden;
							text-overflow: ellipsis;
						}
		
						.description {
							color: var(--fill-secondary);
							font-size: 12px;
							line-height: 16px;
							overflow: hidden;
							text-overflow: ellipsis;
						}

						&.selected {
							&::after {
								background: var(--accent-blue10);
								content: "";
								width: var(--item-horizontal-size);
								height: 100%;
								position: absolute;
								left: 0;
							}
						}
					}
				}

				// handle sections that can be expanded or collapsed
				&.expandable {
					transition: width 0.2s ease-in-out;
					width: calc((var(--item-horizontal-size) * var(--deck-length)) + (var(--item-margin) * (var(--deck-length) - 1)));

					// header has underline effect on hover and has an icon before it
					// indicating current state
					.header {
						-moz-window-dragging: no-drag;
						-moz-user-select: none;
						width: var(--item-horizontal-size);

						display: flex;
						justify-content: space-between;
				
						.header-label {
							@include focus-ring;
							border-radius: 5px;
							&:hover {
								cursor: pointer;
								text-decoration: underline;
							}
							&::before {
								@include svgicon("expand-horizontal", "universal", "16");
								width: 16px;
								height: 16px;
								display: inline-block;
								content: "";
								white-space: pre;
								margin-inline-end: 3px;
								vertical-align: bottom;
							}
						}
					}
					&.expanded {
						.header-label::before {
							@include svgicon("collapse-horizontal", "universal", "16");
						}
					}
					.item {
						z-index: calc(var(--deck-length) - var(--deck-index));
					}
					// collapsed sections move all items under the top first item
					&:not(.expanded) {
						// collapsed deck's width = width of an item + 5px for each item peaking behind the top one (max of 2)
						width: calc(var(--item-horizontal-size) + 5px * min(2, var(--deck-length)));
						.itemsContainer {
							@include focus-ring;
							gap: 0;
						}
						.item:nth-child(1) {
							box-shadow: 2px 0px 4px 0px rgba(0, 0, 0, 0.10)
						}
						// 2nd and 3rd children are moved behind the first item, shrunk slightly and moved a bit to the right
						// (by 16px and 32px) so their edge peaks out behind the top item
						.item:nth-child(2) {
							transform: translateX(calc(-1 * var(--deck-index) * (var(--item-horizontal-size)) + 16px)) scale(0.9);
							box-shadow: 2px 0px 4px 0px rgba(0, 0, 0, 0.10)
						}
						.item:nth-child(3) {
							transform:  translateX(calc(-1 * var(--deck-index) * (var(--item-horizontal-size)) + 32px)) scale(0.8);
							box-shadow: 2px 0px 4px 0px rgba(0, 0, 0, 0.10)
						}
						// remaining item cards are just hidden behind the top item
						.item:nth-child(n + 4) {
							transform: translateX(calc(-1 * var(--deck-index) * (var(--item-horizontal-size))));
						}
					}
				}
				// separate items get a hover effect, unless they are in
				// a collapsed expandable group, in which case the whole group is hovered
				&:not(.expandable), &.expandable.expanded {
					.item:hover {
						background-color: var(--color-quarternary-on-background);
					}
				}
				&.expandable:not(.expanded) {
					.itemsContainer:hover {
						.item {
							background-color: var(--color-quarternary-on-background);
						}
					}
				}	
			}
		}
		#library-trees {
			min-height: 200px;
			flex: 1;
			-moz-window-dragging: no-drag;
			-moz-user-select: none;
	
			#collections-tree-container {
				min-width: 200px;
				min-height: 100%;
				border-inline-end: var(--material-panedivider);
				& > #zotero-collections-tree {
					background: var(--material-sidepane) !important;
					padding-top: 8px;
				}
			}
		
			#item-tree-container {
				min-height: 100%;
				flex: 1; /* expand all the way to the right */

				// the actual column with the +/- button
				.clickable {
					// make sure the button is centered
					display: flex;
					justify-content: center;
					padding: 0;

					// the actual clickable button
					.icon-action {
						display: flex;
						justify-content: center;
						width: 20px;
						height: 20px;
						align-items: center;
						border-radius: 6px;
						.icon {
							width: 16px;
							height: 16px;
						}
						// class to handle hover and active effect, since :hover is applied to the entire row
						&.hover:not([disabled]) {
							background-color: var(--fill-quinary);
						}
						&.active:not([disabled]) {
							background-color: var(--fill-quarternary);
						}
						&[disabled] {
							color: var(--color-gray-50);
						}
					}
				}
				// lighter hover and active effects on +/- buttons in selected rows
				.row.selected {
					.icon-action {
						&.hover:not([disabled]) {
							background-color: #ffffff1a;
						}
						&.active:not([disabled]) {
							background-color: #ffffff33;
						}
					}
				}
			}
		}
	}

	#list-layout {
		#list-layout-wrapper {
			-moz-user-select: none;
			overflow-y: scroll;
			height: 100%;
			.section {
				// show dividers except for on the last section
				.divider {
					margin: 4px 16px;
				}
				&:last-child {
					.divider {
						display: none;
					}
				}
				.header {
					font-weight: 700;
					font-size: 13px;
					color: var(--fill-secondary);
					padding: 4px 8px 4px 16px;
				}
				.item {
					margin: 0 8px;
					padding: 4px 8px;
					border-radius: 5px;
					color: var(--fill-primary);
					-moz-window-dragging: no-drag;
					cursor: default;
					&:hover {
						background-color: var(--fill-quarternary);
					}
					&.selected {
						background: var(--accent-blue30);
						border-radius: 0;
						
					}
					&.selected-first {
						border-top-left-radius: 5px;
						border-top-right-radius: 5px;
					}
					&.selected-last {
						border-bottom-left-radius: 5px;
						border-bottom-right-radius: 5px;
					}

					.icon {
						margin-top: 1px;
						margin-inline-end: 4px;
						flex-shrink: 0;
					}

					.info {
						overflow: hidden;
						.description {
							// Needed to have empty item row description to still occupy height
							white-space: pre;
						}
						.title {
							overflow: hidden;
							text-wrap: nowrap;
							text-overflow: ellipsis;
						}
					}
				}
				&.expandable {
					// styling for expandable header with a twisty
					.header {
						-moz-window-dragging: no-drag;
						-moz-user-select: none;
						display: flex;
						justify-content: space-between;

						.header-label {
							&:hover {
								cursor: pointer;
								text-decoration: underline;
							}
							&::before {
								@include svgicon("chevron-8", "universal", "8");
								width: 8px;
								height: 8px;
								display: inline-block;
								content: "";
								white-space: pre;
								margin-inline-end: 3px;

								transform: rotate(0deg);
								transform-origin: center;
								transition: transform 0.2s ease-in-out;
								vertical-align: middle;
								margin-bottom: 3px;
							}
						}
					}
					&.expanded {
						.header-label::before {
							transform: rotate(180deg);
						}
					}
					// item container has no height when it is collapsed
					.itemsContainer {
						overflow: hidden;
						transition: height 0.3s ease;
					}
					&:not(.expanded) {
						.itemsContainer {
							height: 0 !important; // important to override inline height with items displayed
						}
					}
				}
				.selected {
					background: var(--accent-blue10) !important;
				}
			}
		}
	}

	#bottom-area-wrapper {
		border-top: var(--material-panedivider);
		padding: 4px 10px 4px 12px;

		#bottom-btn-group {
			gap: 10px;
			#mode-button {
				&[mode="library"] {
					@include svgicon("dialog-search-list", "universal", "16");
				}
				&[mode="list"] {
					@include svgicon("dialog-search-library", "universal", "16");
				}
			}
			#settings-button {
				@include svgicon("dialog-options", "universal", "16");
			}
			
		}
	}

	#popups {
		panel {
			padding: 0;
			.popup {
				padding: 15px;

			}
		}
		.overlay {
			position: absolute;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.1);
		}
		#settings-popup {
			top: 35px;
			right: 5px;
			width: 200px;

			.title {
				font-size: 13px;
				font-weight: 700;
				padding-bottom: 8px;
			}
		}
		#itemDetails {
			.popup {
				width: 400px;

				.details-header {
					.icon {
						margin-inline-end: 5px;
						margin-top: 2px;
						flex-shrink: 0;
					}
				}
				.details {
					display: grid;
					align-items: center;
					grid-template-columns: max-content 1fr;
					.details-label {
						margin-top: auto;
						margin-bottom: auto;
						width: min-content;
						margin-inline-start: auto;
					}
				}
				button.done {
					float: right;
					margin-right: 5px;
				}
				button.remove {
					color: var(--accent-red);
				}
			}
		}
	}

	.description {
		color: var(--fill-secondary);
		font-size: 12px;
		// add comma between description <span>s
		span:not(:last-child):not([no-comma])::after {
			content: ", ";
		}
	}

	.aria-hidden {
		position: absolute;
		top: -1000px;
		left: -1000px;
		visibility: hidden;
	}
}